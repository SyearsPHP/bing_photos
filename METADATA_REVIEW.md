# 元数据检查功能使用指南

## 功能概述

为了帮助用户识别和解决音乐文件元数据问题，我们在LRC歌词下载器中新增了"元数据检查"功能。这个功能可以分析音乐文件的元数据，识别可能导致歌词下载失败的问题。

## 主要特性

### 1. 双标签页界面
- **批量下载**：原有的批量歌词下载功能
- **元数据检查**：新增的元数据分析功能

### 2. 支持的文件格式
- MP3 (.mp3)
- WAV (.wav) 
- FLAC (.flac)

### 3. 检测的问题类型

#### 常见元数据问题
- **空字符问题**：检测 `\x00` 等不可见字符
- **字节类型数据**：识别未正确解码的字节数据
- **空白或缺失标签**：检测空的艺术家或歌曲名
- **编码问题**：识别UTF-8编码错误
- **多余空格**：检测前后空格问题

#### 详细分析
- 显示原始元数据用于调试
- 提供具体的问题描述
- 统计正常文件和问题文件数量

## 使用方法

### 步骤1：启动应用程序
```bash
# 激活虚拟环境
source venv/bin/activate

# 启动GUI应用
python main.py
```

### 步骤2：切换到元数据检查标签页
1. 启动应用后，点击"元数据检查"标签页

### 步骤3：选择音乐文件
1. 点击"选择音乐文件"按钮
2. 在文件对话框中选择要检查的音乐文件
3. 支持多选，可以一次选择多个文件

### 步骤4：分析元数据
1. 选择文件后，点击"分析元数据"按钮
2. 等待分析完成
3. 查看表格中的详细结果

### 步骤5：查看结果
表格包含以下列：
- **文件名**：音乐文件的名称
- **格式**：MP3、WAV、FLAC
- **艺术家**：提取的艺术家名称
- **歌曲名**：提取的歌曲名称
- **问题**：检测到的具体问题（如无问题则显示"正常"）
- **原始数据**：用于调试的原始元数据信息

底部会显示统计信息：正常文件数量和有问题文件数量。

## 常见问题解决

### 问题1：空字符 (\x00)
- **症状**：艺术家或歌曲名中包含空字符
- **影响**：可能导致API搜索失败
- **解决**：使用音频标签编辑器清理元数据

### 问题2：字节类型数据
- **症状**：元数据显示为字节而非文本
- **影响**：无法正确读取艺术家和歌曲名
- **解决**：重新编码或使用标签编辑器修复

### 问题3：缺失标签
- **症状**：缺少艺术家或歌曲名标签
- **影响**：无法进行歌词搜索
- **解决**：添加正确的ID3标签

### 问题4：编码问题
- **症状**：包含非UTF-8字符
- **影响**：搜索时可能乱码
- **解决**：转换为UTF-8编码

## 技术细节

### 检测逻辑
1. **MP3文件**：检查TPE1/TIT2和ARTIST/TITLE标签
2. **FLAC文件**：检查Vorbis注释中的artist/title字段
3. **WAV文件**：检查ID3标签中的artist/title字段

### 清理机制
应用内置了元数据清理函数 `_clean_metadata_string()`：
- 自动转换字节为UTF-8字符串
- 移除空字符和不可见字符
- 标准化空格处理
- 过滤空值

## 测试功能

运行测试脚本验证功能：
```bash
source venv/bin/activate
python test_metadata.py
```

测试脚本会验证元数据清理功能是否正常工作。

## 故障排除

### 应用无法启动
- 确保已安装所有依赖：`pip install -r requirements.txt`
- 检查Python版本：需要Python 3.7+

### 文件分析失败
- 确保文件格式受支持（MP3/WAV/FLAC）
- 检查文件是否损坏
- 确保文件权限允许读取

### 元数据显示异常
- 尝试用其他音频软件验证文件元数据
- 考虑使用专业标签编辑器修复文件

## 相关文件

- `gui/main_window.py`：GUI界面和元数据检查逻辑
- `core/music_processor.py`：元数据提取和清理功能
- `test_metadata.py`：功能测试脚本
- `METADATA_REVIEW.md`：本说明文档